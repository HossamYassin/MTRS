@{
    ViewData["Title"] = "My Team";
}

<section class="content" style="margin-top:20px;">
    <div class="container-fluid">
        <div class="card card-primary">
            <div class="card-header">
                <h3 class="card-title">My Team</h3>
            </div>
            <div class="card-body">
                <div class="row">
                    <div id="containerDash" class="container" style="display:none;width: 97%;">

                        <div id="projDashboard" class="row">
                            <div class="col-4">
                                <div class="info-box">
                                    <span class="info-box-icon bg-info"><i class="fas fa-users"></i></span>

                                    <div class="info-box-content">
                                        <span class="info-box-text">Employees</span>
                                        <span id="sEmployeesNumber" class="info-box-number"></span>
                                    </div>
                                    <!-- /.info-box-content -->
                                </div>
                                <!-- /.info-box -->
                            </div>
                            <!-- /.col -->
                            <div class="col-4">
                                <div class="info-box">
                                    <span class="info-box-icon bg-success"><i class="far fa-calendar-alt"></i></span>

                                    <div class="info-box-content">
                                        <span class="info-box-text">Pending Approvals</span>
                                        <span id="sTimesheetNumber" class="info-box-number"></span>
                                    </div>
                                    <!-- /.info-box-content -->
                                </div>
                                <!-- /.info-box -->
                            </div>
                            <!-- /.col -->
                            <div class="col-4">
                                <div class="info-box">
                                    <span class="info-box-icon bg-warning"><i style="color:white;" class="fas fa-list-alt"></i></span>

                                    <div class="info-box-content">
                                        <span class="info-box-text">Team Projects</span>
                                        <span id="sProjects" class="info-box-number"></span>
                                    </div>
                                    <!-- /.info-box-content -->
                                </div>
                                <!-- /.info-box -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row" style="width:100%;">
                    <div id="tabs" class="card card-primary card-tabs" style="width:100%;margin-left:20px;">
                        <div class="card-header p-0 pt-1">
                            <ul class="nav nav-tabs" id="custom-tabs-one-tab" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link active" id="custom-tabs-one-home-tab" data-toggle="pill" href="#custom-tabs-one-home" role="tab" aria-controls="custom-tabs-one-home" aria-selected="true">Employees</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="custom-tabs-one-profile-tab" data-toggle="pill" href="#custom-tabs-one-profile" role="tab" aria-controls="custom-tabs-one-profile" aria-selected="false">Pending TimeSheets</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="custom-tabs-one-messages-tab" data-toggle="pill" href="#custom-tabs-one-messages" role="tab" aria-controls="custom-tabs-one-messages" aria-selected="false">TimeSheets History</a>
                                </li>
                            </ul>
                        </div>
                        <div class="card-body">
                            <div class="tab-content" id="custom-tabs-one-tabContent">
                                <div class="tab-pane fade show active" id="custom-tabs-one-home" role="tabpanel" aria-labelledby="custom-tabs-one-home-tab">
                                    <div class="row">
                                        <div style="width:100%;">
                                            <div class="form-group" style=" margin-left: 20px;float: left; width: 100px;">
                                                <div class="row">
                                                    <button type="button" onclick="loadEmployees();" class="btn btn-primary btn-block" style="width:80px;margin-left:10px;">Reload</button>
                                                </div>
                                            </div>
                                            <div class="form-group" style="float: right; width: 280px;">
                                                <div class="row">
                                                    <div class="input-group" style="width:185px;">
                                                        <input type="text" id="txtSearch" style="width:200px;" class="form-control" data-mask>
                                                    </div>
                                                    <button type="button" onclick="searchEmployees();" class="btn btn-primary btn-block" style="width:80px;margin-left:10px;">Search</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div style="width:100%;">
                                        <div id="tableEmployees">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h3 class="card-title">Employees</h3>
                                                </div>
                                                <!-- ./card-header -->
                                                <div id="treeContainer" class="card-body p-0">
                                                    <div id="employeesTree"></div>
                                                </div>
                                                <!-- /.card-body -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="custom-tabs-one-profile" role="tabpanel" aria-labelledby="custom-tabs-one-profile-tab">
                                    <div id="tablePendingTimeSheets">
                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <div class="form-group">
                                                        <div class="input-group">
                                                            <select id="ddlEmployeesTimeSheets" onchange="ddlEmployeeTimeSheetChange(this);" class="form-control select2bs4">
                                                            </select>
                                                        </div>
                                                        <div class="row" style="margin-left: 8px;margin-top:10px;font-weight:bold;">
                                                            <span id="spNoEmployeesTimesheet" class="alert alert-danger" style="display:none;">There are no pending timesheets.</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <div class="form-group">
                                                        <div class="input-group">
                                                            <select id="ddlTimeSheets" onchange="ddlSheetChange(this);" class="form-control select2bs4">
                                                            </select>
                                                        </div>
                                                        <div class="row" style="margin-left: 8px;margin-top:10px;font-weight:bold;">
                                                            <span id="spNoTimesheet" class="alert alert-danger" style="display:none;">There are no pending timesheets.</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div id="timesheetRow">
                                            <div class="row">
                                                <div class="col-sm-6">
                                                    <div id="timesheetDetails">
                                                    </div>
                                                </div>
                                            </div>
                                            <div id="timeSheetTable" style="display:none;">
                                                <div class="row" style="background-color: darkseagreen;margin-top: 20px;margin-bottom:20px;">
                                                    <div class="col-md-2">
                                                        <div class="input-group">
                                                            <label style="margin-top:10px;">Project</label>
                                                        </div>
                                                    </div>
                                                    <!-- /.col -->
                                                    <div class="col-md-2">
                                                        <div class="input-group">
                                                            <label style="margin-top:10px;margin-left: 72px;">Activity</label>
                                                        </div>
                                                    </div>
                                                    <div style="position: absolute;margin-left: 50%;">
                                                        <div class="row" style=" width: 700px;">
                                                            <div class="time-cell">

                                                            </div>
                                                            <div class="time-cell">
                                                                <div class="input-group">
                                                                    <label>Sun</label>
                                                                </div>
                                                            </div>
                                                            <div class="time-cell">
                                                                <div class="input-group">
                                                                    <label>Mon</label>
                                                                </div>
                                                            </div>
                                                            <div class="time-cell">
                                                                <div class="input-group">
                                                                    <label>Tu</label>
                                                                </div>
                                                            </div>
                                                            <div class="time-cell">
                                                                <div class="input-group">
                                                                    <label>We</label>
                                                                </div>
                                                            </div>
                                                            <div class="time-cell">
                                                                <div class="input-group">
                                                                    <label>Th</label>
                                                                </div>
                                                            </div>
                                                            <div class="time-cell" style="display:none;">
                                                                <div class="input-group">
                                                                    <label>Fri</label>
                                                                </div>
                                                            </div>
                                                            <div class="time-cell" style="display:none;">
                                                                <div class="input-group">
                                                                    <label>Sat</label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div id="tsContainer"></div>
                                                <!-- footer -->
                                                <div class="row" style="background-color: darkseagreen;">
                                                    <div class="time-cell-total" style="font-weight:bold; width: 90px; padding-top: 8px; margin-left: 47%;">
                                                        Total Hours
                                                    </div>
                                                    <div class="time-cell-total">
                                                        <div class="input-group">
                                                            <input readonly type="text" class="form-control sunTotal" data-mask>
                                                        </div>
                                                    </div>
                                                    <div class="time-cell-total">
                                                        <div class="input-group">
                                                            <input readonly type="text" class="form-control monTotal" data-mask>
                                                        </div>
                                                    </div>
                                                    <div class="time-cell-total">
                                                        <div class="input-group">
                                                            <input readonly type="text" class="form-control tuTotal" data-mask>
                                                        </div>
                                                    </div>
                                                    <div class="time-cell-total">
                                                        <div class="input-group">
                                                            <input readonly type="text" class="form-control weTotal" data-mask>
                                                        </div>
                                                    </div>
                                                    <div class="time-cell-total">
                                                        <div class="input-group">
                                                            <input readonly type="text" class="form-control thTotal" data-mask>
                                                        </div>
                                                    </div>
                                                    <div class="time-cell-total" style="display:none;">
                                                        <div class="input-group">
                                                            <input readonly type="text" class="form-control friTotal" data-mask>
                                                        </div>
                                                    </div>
                                                    <div class="time-cell-total" style="display:none;">
                                                        <div class="input-group">
                                                            <input readonly type="text" class="form-control satTotal" data-mask>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-1">
                                                        <button onclick="approveTimeSheet();" type="button" class="btn btn-primary btn-block" style="width:120px;margin-top:20px;">Approve</button>
                                                    </div>
                                                    <div class="col-1" style="margin-left:60px;">
                                                        <button onclick="rejectTimeSheet();" type="button" class="btn btn-danger btn-block" style="width:120px;margin-top:20px; background-color:red;">Reject</button>
                                                    </div>
                                                    <!-- /.col -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="custom-tabs-one-messages" role="tabpanel" aria-labelledby="custom-tabs-one-messages-tab">
                                    <div id="tableHistoryTimeSheets">
                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <div class="form-group">
                                                        <div class="input-group">
                                                            <select id="ddlEmployeesHistoryTimeSheets" onchange="ddlEmployeeTimeSheetHistoryChange(this);" class="form-control select2bs4">
                                                            </select>
                                                        </div>
                                                        <div class="row" style="margin-left: 8px;margin-top:10px;font-weight:bold;">
                                                            <span id="spNoEmployeesTimesheetHistory" class="alert alert-danger" style="display:none;">There are no timesheets.</span>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <div class="form-group">
                                                        <div class="input-group">
                                                            <select id="ddlTimeSheetsHistory" style="display:none;" onchange="ddlSheetHistoryChange(this);" class="form-control select2bs4">
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div id="timesheetRowHistory">
                                            <div class="row">
                                                <div class="col-sm-6">
                                                    <div id="timesheetHistoryDetails">
                                                    </div>
                                                </div>
                                            </div>
                                            <div id="timeSheetHistoryTable" style="display:none;">
                                                <div class="row" style="background-color: darkseagreen;margin-top: 20px;margin-bottom:20px;">
                                                    <div class="col-md-2">
                                                        <div class="input-group">
                                                            <label style="margin-top:10px;">Project</label>
                                                        </div>
                                                    </div>
                                                    <!-- /.col -->
                                                    <div class="col-md-2">
                                                        <div class="input-group">
                                                            <label style="margin-top:10px;margin-left: 72px;">Activity</label>
                                                        </div>
                                                    </div>
                                                    <div style="position: absolute;margin-left: 50%;">
                                                        <div class="row" style=" width: 700px;">
                                                            <div class="time-cell">

                                                            </div>
                                                            <div class="time-cell">
                                                                <div class="input-group">
                                                                    <label>Sun</label>
                                                                </div>
                                                            </div>
                                                            <div class="time-cell">
                                                                <div class="input-group">
                                                                    <label>Mon</label>
                                                                </div>
                                                            </div>
                                                            <div class="time-cell">
                                                                <div class="input-group">
                                                                    <label>Tu</label>
                                                                </div>
                                                            </div>
                                                            <div class="time-cell">
                                                                <div class="input-group">
                                                                    <label>We</label>
                                                                </div>
                                                            </div>
                                                            <div class="time-cell">
                                                                <div class="input-group">
                                                                    <label>Th</label>
                                                                </div>
                                                            </div>
                                                            <div class="time-cell" style="display:none;">
                                                                <div class="input-group">
                                                                    <label>Fri</label>
                                                                </div>
                                                            </div>
                                                            <div class="time-cell" style="display:none;">
                                                                <div class="input-group">
                                                                    <label>Sat</label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div id="tsContainerHistory"></div>
                                                <!-- footer -->
                                                <div class="row" style="background-color: darkseagreen;">
                                                    <div class="time-cell-total" style="font-weight:bold; width: 90px; padding-top: 8px; margin-left: 47%;">
                                                        Total Hours
                                                    </div>
                                                    <div class="time-cell-total">
                                                        <div class="input-group">
                                                            <input readonly type="text" class="form-control sunTotal" data-mask>
                                                        </div>
                                                    </div>
                                                    <div class="time-cell-total">
                                                        <div class="input-group">
                                                            <input readonly type="text" class="form-control monTotal" data-mask>
                                                        </div>
                                                    </div>
                                                    <div class="time-cell-total">
                                                        <div class="input-group">
                                                            <input readonly type="text" class="form-control tuTotal" data-mask>
                                                        </div>
                                                    </div>
                                                    <div class="time-cell-total">
                                                        <div class="input-group">
                                                            <input readonly type="text" class="form-control weTotal" data-mask>
                                                        </div>
                                                    </div>
                                                    <div class="time-cell-total">
                                                        <div class="input-group">
                                                            <input readonly type="text" class="form-control thTotal" data-mask>
                                                        </div>
                                                    </div>
                                                    <div class="time-cell-total" style="display:none;">
                                                        <div class="input-group">
                                                            <input readonly type="text" class="form-control friTotal" data-mask>
                                                        </div>
                                                    </div>
                                                    <div class="time-cell-total" style="display:none;">
                                                        <div class="input-group">
                                                            <input readonly type="text" class="form-control satTotal" data-mask>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- /.card -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<div class="modal fade" id="addComments" aria-modal="true" role="dialog">
    <div class="modal-dialog modal-sm">
        <div class="modal-content" style="width: 550px;">
            <div class="modal-header">
                <h4 class="modal-title">Reject comment</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="card-body">
                    <div class="row" style="width: 600px;">
                        <div style="width:500px;">
                            <div class="form-group">
                                <label>Comment<span style="color:red;">*</span></label>
                                <div class="input-group">
                                    <textarea type="text" id="inpComment" class="form-control" data-mask style="height:100px;"></textarea>
                                </div>
                                <div class="row" style="margin-left: 3px;">
                                    <span id="errComment" style="color:red;display:none;">Comment is required</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- /.row -->
                </div>
            </div>
            <div class="modal-footer justify-content-between">
                <!-- /.row -->
                <div class="row">
                    <div class="col-4">
                        <button type="button" onclick="addRejectComment();" class="btn btn-primary btn-block" style="width:80px;margin-top:20px;margin-left: 20px;">Save</button>
                    </div>
                    <!-- /.col -->
                </div>

            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>

<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.css">

<link href="https://www.jqueryscript.net/css/jquerysctipttop.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/flick/jquery-ui.css">
<link href="https://jonmiles.github.io/bootstrap-treeview/css/bootstrap-treeview.css" rel="stylesheet">

<!-- Select2 -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/4.4.1/flatly/bootstrap.min.css">
<link rel="stylesheet" href="~/plugins/select2/css/select2.min.css">
<link rel="stylesheet" href="~/plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css">
<script src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<script src="~/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>
@*<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>*@
<script type="text/javascript" src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>

@*<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>*@
<script src="~/plugins/select2/js/select2.full.min.js"></script>
<script src="~/js/bstreeview.min.js"></script>

<link rel="stylesheet" href="http://cdn.jsdelivr.net/gh/xxjapp/xdialog@3/xdialog.min.css">
<script src="http://cdn.jsdelivr.net/gh/xxjapp/xdialog@3/xdialog.min.js"></script>


<script type="text/javascript">

    var managerId = 0;

    var employees = null;

    function getDashboard() {
        //get project projDashboard
        xdialog.startSpin();
        $.ajax({
            type: "GET",
            url: "/manager/GetDashboard",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {
                $("#sEmployeesNumber").text(data.employeesCount);
                $("#sTimesheetNumber").text(data.pendingTimeSheetCount);
                $('#sProjects').text(data.teamProjectsCount)
                $("#containerDash").attr('style', 'display:block;margin-left: 10px;width: 97%;');
                xdialog.stopSpin();
            },
            failure: function (response) {
                console.log(response);
                xdialog.stopSpin();
            }
        });
    }
    $(document).ready(function () {
        getDashboard();

    });

    $(document).ready(function () {
        $("#ddlEmployees").select2({
            allowClear: true
        });

        $("#ddlEmployeesTimeSheets").select2({
            allowClear: true
        });

        $.ajax({
            type: "GET",
            url: "/manager/getmyemployees",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {
                console.log(data);
                employees = data;
                $('#employeesTree').html('');
                $('#employeesTree').bstreeview({ data: JSON.stringify(data.nodes) });
            },
            failure: function (response) {
                console.log(response);
            }
        });

        //get pending employees GetPendingEmployeesByProject
        xdialog.startSpin();
        $.ajax({
            type: "GET",
            url: "/manager/GetTeamPendingEmployees",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {
                console.log(data);
                if (data.length > 0) {
                    $('#ddlEmployeesTimeSheets').attr('style', 'display:block;');
                    $('#ddlTimeSheets').attr('style', 'display:block;');
                    $('#spNoEmployeesTimesheet').attr('style', 'display:none;');
                    $("#ddlEmployeesTimeSheets").empty();
                    $('#ddlEmployeesTimeSheets').append($("<option value='0'>-- Select Employee --</option>"));

                    $.each(data, function () {
                        $("#ddlEmployeesTimeSheets").append($("<option></option>").val(this.id).html(this.firstName));
                    });
                    $('#ddlTimeSheets').attr('style', 'display:none;')
                    xdialog.stopSpin();
                }
                else {
                    $('#spNoEmployeesTimesheet').attr('style', 'display:block;');
                    $('#ddlEmployeesTimeSheets').attr('style', 'display:none;');
                    $('#ddlEmployeesTimeSheets').empty();
                    $('#ddlTimeSheets').attr('style', 'display:none;');
                    $('#timesheetRow').attr('style', 'display:none;');
                    $('#timeSheetTable').attr('style', 'display:none;');
                    xdialog.stopSpin();
                }
            },
            failure: function (response) {
                console.log(response);
                xdialog.stopSpin();
            }
        });

        xdialog.startSpin();
        $.ajax({
            type: "GET",
            url: "/manager/GetMyEmployeesList",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {
                console.log(data);
                if (data.length > 0) {
                    $('#ddlEmployeesHistoryTimeSheets').attr('style', 'display:block;');
                    $("#ddlEmployeesHistoryTimeSheets").empty();
                    $('#ddlEmployeesHistoryTimeSheets').append($("<option value='0'>-- Select Employee --</option>"));
                    $.each(data, function () {
                        $("#ddlEmployeesHistoryTimeSheets").append($("<option></option>").val(this.id).html(this.firstName));
                    });
                    $('#timesheetRowHistory').attr('style', 'display:block;');
                    xdialog.stopSpin();
                }
                else {

                    $('#ddlEmployeesHistoryTimeSheets').attr('style', 'display:none;');
                    $('#ddlEmployeesHistoryTimeSheets').empty();
                    $('#ddlTimeSheetsHistory').attr('style', 'display:none;');
                    $('#timesheetRowHistory').attr('style', 'display:none;');
                    $('#timeSheetHistoryTable').attr('style', 'display:none;');
                    xdialog.stopSpin();
                }
            },
            failure: function (response) {
                console.log(response);
                xdialog.stopSpin();
            }
        });
    });

    function loadEmployees() {
        xdialog.startSpin();

        $.ajax({
            type: "GET",
            url: "/manager/getmyemployees",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {
                employees = data;
                console.log(data);
                $('#treeContainer').html('');
                $('#treeContainer').append('<div id="employeesTree"></div>');

                $('#employeesTree').bstreeview({ data: JSON.stringify(data.nodes) });
                xdialog.stopSpin();
            },
            failure: function (response) {
                console.log(response);
                xdialog.stopSpin();
            }
        });
    }

    function searchEmployees(txtSearch) {
        if ($('#txtSearch').val() != '') {
            xdialog.startSpin();
            $.ajax({
                type: "GET",
                url: "/manager/SearchEmployees?name=" + $('#txtSearch').val(),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    console.log(data);
                    $('#treeContainer').html('');
                    $('#treeContainer').append('<div id="employeesTree"></div>');
                    $('#employeesTree').bstreeview({ data: JSON.stringify(data) });
                    xdialog.stopSpin();
                },
                failure: function (response) {
                    console.log(response);
                    xdialog.stopSpin();
                }
            });
        }
        else {
            loadEmployees();
        }
    }
</script>

<style>
    .dataTables_wrapper {
        margin-top: 20px;
        margin-bottom: 20px;
        width: 100%;
    }

    .dataTables_length {
        margin-top: 20px;
        margin-left: 10px;
    }

    .dataTables_filter {
        margin-top: 20px;
        margin-right: 20px;
    }

    .dataTables_info {
        margin-left: 10px;
    }

    .select2-selection.select2-selection--single {
        height: 38px !important;
    }
</style>

<script type="text/javascript">

    function viewTimesheet(id) {
        $("#custom-tabs-one-messages-tab").click();
        $('#ddlEmployeesHistoryTimeSheets').val(id);
        ddlEmployeeTimeSheetHistoryChange($('#ddlEmployeesHistoryTimeSheets'));
    }

    function ddlEmployeeTimeSheetChange() {
        xdialog.startSpin();
        $.ajax({
            type: "GET",
            url: "/manager/GetEmployeeTimeSheet?employeeId=" + $('#ddlEmployeesTimeSheets').val(),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {
                if (data.length > 0) {
                    $('#ddlTimeSheets').empty();
                    $('#ddlTimeSheets').attr('style', 'display:block;')

                    $.each(data, function () {
                        var fromDate = new Date(this.fromDate);
                        var toDate = new Date(this.toDate);

                        var text = "From " + fromDate.formatMMDDYYYY() + " To " + toDate.formatMMDDYYYY();
                        $('#ddlTimeSheets').append($("<option></option>").val(this.id).html(text));
                    });
                    $('#spNoTimesheet').attr('style', 'display:none;');
                    ddlSheetChange($('#ddlTimeSheets'));
                    xdialog.stopSpin();
                }
                else {
                    $('#timeSheetTable').attr('style', 'display:none;');
                    $('#spNoTimesheet').attr('style', 'display:block;');
                    xdialog.stopSpin();
                }
            },
            failure: function (response) {
                xdialog.stopSpin();
                console.log(response);
            }
        });
    }

    function ddlEmployeeTimeSheetHistoryChange(ddlemployees) {
        if ($('#ddlEmployeesHistoryTimeSheets').val() != '0') {

            xdialog.startSpin();
            $.ajax({
                type: "GET",
                url: "/timesheet/GetTimeSheetHistory?userId=" + $('#ddlEmployeesHistoryTimeSheets').val(),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    if (data.length > 0) {
                        $('#ddlTimeSheetsHistory').empty();
                        $('#ddlTimeSheetsHistory').attr('style', 'display:block;');
                        $('#spNoEmployeesTimesheetHistory').attr('style', 'display:none;');
                        $('#timesheetRowHistory').attr('style', 'display:block;');

                        $.each(data, function () {
                            var fromDate = new Date(this.fromDate);
                            var toDate = new Date(this.toDate);

                            var text = "From " + fromDate.formatMMDDYYYY() + " To " + toDate.formatMMDDYYYY();
                            $('#ddlTimeSheetsHistory').append($("<option></option>").val(this.id).html(text));
                        });
                        ddlSheetHistoryChange($('#ddlTimeSheetsHistory'));
                        xdialog.stopSpin();
                    }
                    else {
                        $('#ddlTimeSheetsHistory').empty();
                        $('#ddlTimeSheetsHistory').attr('style', 'display:none;');
                        $('#timesheetRowHistory').attr('style', 'display:none;');
                        $('#timeSheetHistoryTable').attr('style', 'display:none;');
                        $('#spNoEmployeesTimesheetHistory').attr('style', 'display:block;');
                        xdialog.stopSpin();
                    }
                },
                failure: function (response) {
                    xdialog.stopSpin();
                    console.log(response);
                }
            });
        }
        else {
            $('#ddlTimeSheetsHistory').empty();
            $('#ddlTimeSheetsHistory').attr('style', 'display:none;');
            $('#timesheetRowHistory').attr('style', 'display:none;');
            $('#timeSheetHistoryTable').attr('style', 'display:none;');
            $('#timeSheetTable').attr('style', 'display:none;');
            $('#spNoEmployeesTimesheetHistory').attr('style', 'display:none;');
        }
    }
    function loadPendingUsersSheets() {
        xdialog.startSpin();
        $.ajax({
            type: "GET",
            url: "/timesheet/GetHistory",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {
                if (data.length > 0) {
                    $('#ddlTimeSheets').empty();
                    $.each(data, function () {
                        var fromDate = new Date(this.fromDate);
                        var toDate = new Date(this.toDate);

                        var text = "From " + fromDate.formatMMDDYYYY() + " To " + toDate.formatMMDDYYYY();
                        $('#ddlTimeSheets').append($("<option></option>").val(this.id).html(text));
                    });
                    ddlSheetChange($('#ddlTimeSheets'));
                    xdialog.stopSpin();
                }
                else {
                    $('#timeSheetTable').attr('style', 'display:none;');
                    $('#spNoTimesheet').attr('style', 'display:block;');
                    xdialog.stopSpin();
                }
            },
            failure: function (response) {
                xdialog.stopSpin();
                console.log(response);
            }
        });
    }

    function ddlSheetChange(ddlSheets) {
        xdialog.startSpin();
        $.ajax({
            type: "GET",
            url: "/timesheet/GetDetailsByTimeSheetId?timesheetId=" + $(ddlSheets).val(),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {
                if (data != "No date found!") {
                    $('#spNoTimesheet').attr("style", "display:none;");
                    $('#tsContainer').html('');
                    var rowId = 1;
                    if (data.length > 0) {
                        $('#timeSheetTable').attr('style', 'display:block;')
                        $('#spNoTimesheet').attr("style", "display:none;");
                        $.each(data, function () {
                            fillSheetRow(this, rowId);
                            rowId += 1;
                        });
                        totalHours();
                    }
                    else {
                        $('#timeSheetTable').attr('style', 'display:none;')
                        $('#spNoTimesheet').attr("style", "display:block;");
                    }
                }
                else {
                    $('#spNoTimesheet').attr("style", "display:block;");
                }
                $.ajax({
                    type: "GET",
                    url: "/timesheet/GetApprovalTimeLine?timesheetId=" + $(ddlSheets).val(),
                    contentType: "application/json; charset=utf-8",
                    dataType: 'html',
                    success: function (data) {
                        $('#timesheetDetails').html(data);
                    }
                });
                xdialog.stopSpin();
            },
            failure: function (response) {
                xdialog.stopSpin();
                console.log(response);
            }
        });
    }

    function ddlSheetHistoryChange(ddlSheets) {
        xdialog.startSpin();
        $.ajax({
            type: "GET",
            url: "/timesheet/GetDetailsByTimeSheetId?timesheetId=" + $(ddlSheets).val(),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {
                if (data != "No date found!") {
                    $('#tsContainerHistory').html('');
                    var rowId = 1;
                    if (data.length > 0) {
                        $('#timeSheetHistoryTable').attr('style', 'display:block;')
                        $.each(data, function () {
                            fillSheetRowHistory(this, rowId);
                            rowId += 1;
                        });
                        totalHoursHistory();
                    }
                    else {
                        $('#timeSheetHistoryTable').attr('style', 'display:none;')
                    }
                }

                $.ajax({
                    type: "GET",
                    url: "/timesheet/GetApprovalTimeLine?timesheetId=" + $(ddlSheets).val(),
                    contentType: "application/json; charset=utf-8",
                    dataType: 'html',
                    success: function (data) {
                        $('#timesheetHistoryDetails').html(data);
                    }
                });
                xdialog.stopSpin();
            },
            failure: function (response) {
                xdialog.stopSpin();
                console.log(response);
            }
        });
    }

    function fillSheetRowHistory(timesheetRow, rowId) {

        var content = '<div id="row1" class="row tsRow" style="margin-bottom:36px"><div class="row" style="width:55%;margin-left:1px;margin-top:8px;"><div class="col-md-5"><div class="form-group"><div class="input-group" style="padding-top:6px"><select id="ddlPro1" onchange="ddlProjChange(this)" class="form-control select2bs4"><option>-- Select --</option></select></div></div></div><div class="col-md-5"><div class="form-group"><div class="input-group" style="padding-top:6px"><select id="ddlAct1" class="form-control select2bs4"><option>-- Select --</option></select></div></div></div><div class="row"><input id="txtComment1" class="form-control" placeholder="Comment" style="margin-left:30px;width:445px;"></div></div><div style="position:absolute;margin-left:50%"><div class="row ST"><div class="time-cell" style="padding-top:8px">ST</div><div class="time-cell"><div class="input-group"><input maxlength="1"  onkeypress="return validateHours(event);" class="form-control sun" data-mask></div></div><div class="time-cell"><div class="input-group"><input maxlength="1"  onkeypress="return validateHours(event);" class="form-control mon" data-mask></div></div><div class="time-cell"><div class="input-group"><input maxlength="1"  onkeypress="return validateHours(event);" class="form-control tu" data-mask></div></div><div class="time-cell"><div class="input-group"><input maxlength="1"  onkeypress="return validateHours(event);" class="form-control we" data-mask></div></div><div class="time-cell"><div class="input-group"><input maxlength="1"  onkeypress="return validateHours(event);" class="form-control th" data-mask></div></div><div class="time-cell"><div class="input-group"><input maxlength="1"  onkeypress="return validateHours(event);" class="form-control fri" data-mask></div></div><div class="time-cell"><div class="input-group"><input maxlength="1"  onkeypress="return validateHours(event);" class="form-control sat" data-mask></div></div></div><div class="row OT"><div class="time-cell" style="padding-top:8px">OT</div><div class="time-cell"><div class="input-group"><input maxlength="1"  onkeypress="return validateHours(event);" class="form-control sun" data-mask></div></div><div class="time-cell"><div class="input-group"><input maxlength="1"  onkeypress="return validateHours(event);" class="form-control mon" data-mask></div></div><div class="time-cell"><div class="input-group"><input maxlength="1"  onkeypress="return validateHours(event);" class="form-control tu" data-mask></div></div><div class="time-cell"><div class="input-group"><input maxlength="1"  onkeypress="return validateHours(event);" class="form-control we" data-mask></div></div><div class="time-cell"><div class="input-group"><input maxlength="1"  onkeypress="return validateHours(event);" class="form-control th" data-mask></div></div><div class="time-cell"><div class="input-group"><input maxlength="1"  onkeypress="return validateHours(event);" class="form-control fri" data-mask></div></div><div class="time-cell"><div class="input-group"><input maxlength="1"  onkeypress="return validateHours(event);" class="form-control sat" data-mask></div></div></div></div><div style="position:absolute;margin-left:96%;margin-top:44px"><i class="fas fa-trash" style="color:red;cursor:pointer;display:none;" onclick="deleteRow(this)"></i></div></div>';
        content = content.replace("row1", "row" + rowId);
        content = content.replace("ddlPro1", "ddlPro" + rowId);
        content = content.replace("ddlAct1", "ddlAct" + rowId);
        content = content.replace("txtComment1", "txtComment" + rowId);

        $(content).appendTo($('#tsContainerHistory'));

        if (timesheetRow.activity.type == 2) {
            var projList = $('#tsContainerHistory').find('#ddlPro' + rowId);

            $.ajax({
                type: "GET",
                url: "/project/GetProjects?userId=" + $('#ddlEmployeesHistoryTimeSheets').val(),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    projList.attr('isPro', 'true');
                    projList.empty();
                    $.each(data, function () {
                        projList.append($("<option></option>").val(this.id).html(this.name));
                    });
                    projList.val(timesheetRow.activity.projectId);
                    $.ajax({
                        type: "GET",
                        url: "/activity/GetProjectActivity?projectId=" + projList.val() + "&userId=" + $('#ddlEmployeesHistoryTimeSheets').val(),
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (data) {
                            $('#tsContainerHistory').find("#ddlAct" + rowId).empty();
                            $.each(data, function () {
                                $('#tsContainerHistory').find("#ddlAct" + rowId).append($("<option></option>").val(this.id).html(this.name));
                            });
                            $('#tsContainerHistory').find('#ddlAct' + rowId).val(timesheetRow.activityId);
                        },
                        failure: function (response) {
                            console.log(response);
                        }
                    });
                },
                failure: function (response) {
                    console.log(response);
                }
            });

        }
        else {
            var projList = $('#tsContainerHistory').find('#ddlPro' + rowId);
            projList.attr('isPro', 'false');
            projList.empty();
            projList.append($("<option></option>").val('General').html('General Activities'));

            $.ajax({
                type: "GET",
                url: "/Activity/GetGeneral",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    $('#tsContainerHistory').find("#ddlAct" + rowId).empty();
                    $.each(data, function () {
                        $('#tsContainerHistory').find('#ddlAct' + rowId).append($("<option></option>").val(this.id).html(this.name));
                    });
                    $('#tsContainerHistory').find('#ddlAct' + rowId).val(timesheetRow.activityId);
                },
                failure: function (response) {
                    console.log(response);
                }
            });
        }

        $('#tsContainerHistory').find('#txtComment' + rowId).val(timesheetRow.comments);

        $('#tsContainerHistory').find('#row' + rowId + ' .ST .sun')[0].value = timesheetRow.sun == undefined ? "0" : timesheetRow.sun;
        $('#tsContainerHistory').find('#row' + rowId + ' .ST .mon')[0].value = timesheetRow.mon == undefined ? "0" : timesheetRow.mon;
        $('#tsContainerHistory').find('#row' + rowId + ' .ST .tu')[0].value = timesheetRow.tu == undefined ? "0" : timesheetRow.tu;
        $('#tsContainerHistory').find('#row' + rowId + ' .ST .we')[0].value = timesheetRow.we == undefined ? "0" : timesheetRow.we;
        $('#tsContainerHistory').find('#row' + rowId + ' .ST .th')[0].value = timesheetRow.th == undefined ? "0" : timesheetRow.th;
        $('#tsContainerHistory').find('#row' + rowId + ' .ST .fri')[0].value = timesheetRow.fri == undefined ? "0" : timesheetRow.fri;
        $('#tsContainerHistory').find('#row' + rowId + ' .ST .sat')[0].value = timesheetRow.sat == undefined ? "0" : timesheetRow.sat;


        $('#tsContainerHistory').find('#row' + rowId + ' .OT .sun')[0].value = timesheetRow.sunOver == undefined ? "0" : timesheetRow.sunOver;
        $('#tsContainerHistory').find('#row' + rowId + ' .OT .mon')[0].value = timesheetRow.monOver == undefined ? "0" : timesheetRow.monOver;
        $('#tsContainerHistory').find('#row' + rowId + ' .OT .tu')[0].value = timesheetRow.tuOver == undefined ? "0" : timesheetRow.tuOver;
        $('#tsContainerHistory').find('#row' + rowId + ' .OT .we')[0].value = timesheetRow.weOver == undefined ? "0" : timesheetRow.weOver;
        $('#tsContainerHistory').find('#row' + rowId + ' .OT .th')[0].value = timesheetRow.thOver == undefined ? "0" : timesheetRow.thOver;
        $('#tsContainerHistory').find('#row' + rowId + ' .OT .fri')[0].value = timesheetRow.friOver == undefined ? "0" : timesheetRow.friOver;
        $('#tsContainerHistory').find('#row' + rowId + ' .OT .sat')[0].value = timesheetRow.satOver == undefined ? "0" : timesheetRow.satOver;

        $('#tsContainerHistory').find('.ST input').on('change', function () { totalHoursHistory(); });
        $('#tsContainerHistory').find('.OT input').on('change', function () { totalHoursHistory(); });

        $('#tsContainerHistory input').each(function () {
            $(this).attr('readonly', 'readonly');
        });

        $('#tsContainerHistory select').each(function () {
            $(this).attr('readonly', 'readonly');
        });

        $('.row .OT').attr('style', 'display: none;');
        $('.ST .input-group .fri').each(function () {
            $(this).prop("readonly", true);
            $(this).prop("disabled", true);
            $(this).attr("style", "display:none;");

        });
        $('.ST .input-group .sat').each(function () {
            $(this).prop("readonly", true);
            $(this).prop("disabled", true);
            $(this).attr("style", "display:none;");
        });
    }

    function fillSheetRow(timesheetRow, rowId) {

        var content = '<div id="row1" class="row tsRow" style="margin-bottom:36px"><div class="row" style="width:55%;margin-left:1px;margin-top:8px;"><div class="col-md-5"><div class="form-group"><div class="input-group" style="padding-top:6px"><select id="ddlPro1" onchange="ddlProjChange(this)" class="form-control select2bs4"><option>-- Select --</option></select></div></div></div><div class="col-md-5"><div class="form-group"><div class="input-group" style="padding-top:6px"><select id="ddlAct1" class="form-control select2bs4"><option>-- Select --</option></select></div></div></div><div class="row"><input id="txtComment1" class="form-control" placeholder="Comment" style="margin-left:30px;width:445px;"></div></div><div style="position:absolute;margin-left:50%"><div class="row ST"><div class="time-cell" style="padding-top:8px">ST</div><div class="time-cell"><div class="input-group"><input maxlength="1"  onkeypress="return validateHours(event);" class="form-control sun" data-mask></div></div><div class="time-cell"><div class="input-group"><input maxlength="1"  onkeypress="return validateHours(event);" class="form-control mon" data-mask></div></div><div class="time-cell"><div class="input-group"><input maxlength="1"  onkeypress="return validateHours(event);" class="form-control tu" data-mask></div></div><div class="time-cell"><div class="input-group"><input maxlength="1"  onkeypress="return validateHours(event);" class="form-control we" data-mask></div></div><div class="time-cell"><div class="input-group"><input maxlength="1"  onkeypress="return validateHours(event);" class="form-control th" data-mask></div></div><div class="time-cell"><div class="input-group"><input maxlength="1"  onkeypress="return validateHours(event);" class="form-control fri" data-mask></div></div><div class="time-cell"><div class="input-group"><input maxlength="1"  onkeypress="return validateHours(event);" class="form-control sat" data-mask></div></div></div><div class="row OT"><div class="time-cell" style="padding-top:8px">OT</div><div class="time-cell"><div class="input-group"><input maxlength="1"  onkeypress="return validateHours(event);" class="form-control sun" data-mask></div></div><div class="time-cell"><div class="input-group"><input maxlength="1"  onkeypress="return validateHours(event);" class="form-control mon" data-mask></div></div><div class="time-cell"><div class="input-group"><input maxlength="1"  onkeypress="return validateHours(event);" class="form-control tu" data-mask></div></div><div class="time-cell"><div class="input-group"><input maxlength="1"  onkeypress="return validateHours(event);" class="form-control we" data-mask></div></div><div class="time-cell"><div class="input-group"><input maxlength="1"  onkeypress="return validateHours(event);" class="form-control th" data-mask></div></div><div class="time-cell"><div class="input-group"><input maxlength="1"  onkeypress="return validateHours(event);" class="form-control fri" data-mask></div></div><div class="time-cell"><div class="input-group"><input maxlength="1"  onkeypress="return validateHours(event);" class="form-control sat" data-mask></div></div></div></div><div style="position:absolute;margin-left:96%;margin-top:44px"><i class="fas fa-trash" style="color:red;cursor:pointer;display:none;" onclick="deleteRow(this)"></i></div></div>';
        content = content.replace("row1", "row" + rowId);
        content = content.replace("ddlPro1", "ddlPro" + rowId);
        content = content.replace("ddlAct1", "ddlAct" + rowId);
        content = content.replace("txtComment1", "txtComment" + rowId);

        $(content).appendTo($('#tsContainer'));

        if (timesheetRow.activity.type == 2) {
            var projList = $('#ddlPro' + rowId);

            $.ajax({
                type: "GET",
                url: "/project/GetProjects?userId=" + $('#ddlEmployeesTimeSheets').val(),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    projList.attr('isPro', 'true');
                    projList.empty();
                    $.each(data, function () {
                        projList.append($("<option></option>").val(this.id).html(this.name));
                    });
                    projList.val(timesheetRow.activity.projectId);
                    $.ajax({
                        type: "GET",
                        url: "/activity/GetProjectActivity?projectId=" + projList.val() + "&userId=" + $('#ddlEmployeesTimeSheets').val(),
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (data) {
                            $("#ddlAct" + rowId).empty();
                            $.each(data, function () {
                                $("#ddlAct" + rowId).append($("<option></option>").val(this.id).html(this.name));
                            });
                            $('#ddlAct' + rowId).val(timesheetRow.activityId);
                        },
                        failure: function (response) {
                            console.log(response);
                        }
                    });
                },
                failure: function (response) {
                    console.log(response);
                }
            });

        }
        else {
            var projList = $('#ddlPro' + rowId);
            projList.attr('isPro', 'false');
            projList.empty();
            projList.append($("<option></option>").val('General').html('General Activities'));

            $.ajax({
                type: "GET",
                url: "/Activity/GetGeneral",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    $("#ddlAct" + rowId).empty();
                    $.each(data, function () {
                        $('#ddlAct' + rowId).append($("<option></option>").val(this.id).html(this.name));
                    });
                    $('#ddlAct' + rowId).val(timesheetRow.activityId);
                },
                failure: function (response) {
                    console.log(response);
                }
            });
        }

        $('#txtComment' + rowId).val(timesheetRow.comments);

        $('#row' + rowId + ' .ST .sun')[0].value = timesheetRow.sun == undefined ? "0" : timesheetRow.sun;
        $('#row' + rowId + ' .ST .mon')[0].value = timesheetRow.mon == undefined ? "0" : timesheetRow.mon;
        $('#row' + rowId + ' .ST .tu')[0].value = timesheetRow.tu == undefined ? "0" : timesheetRow.tu;
        $('#row' + rowId + ' .ST .we')[0].value = timesheetRow.we == undefined ? "0" : timesheetRow.we;
        $('#row' + rowId + ' .ST .th')[0].value = timesheetRow.th == undefined ? "0" : timesheetRow.th;
        $('#row' + rowId + ' .ST .fri')[0].value = timesheetRow.fri == undefined ? "0" : timesheetRow.fri;
        $('#row' + rowId + ' .ST .sat')[0].value = timesheetRow.sat == undefined ? "0" : timesheetRow.sat;


        $('#row' + rowId + ' .OT .sun')[0].value = timesheetRow.sunOver == undefined ? "0" : timesheetRow.sunOver;
        $('#row' + rowId + ' .OT .mon')[0].value = timesheetRow.monOver == undefined ? "0" : timesheetRow.monOver;
        $('#row' + rowId + ' .OT .tu')[0].value = timesheetRow.tuOver == undefined ? "0" : timesheetRow.tuOver;
        $('#row' + rowId + ' .OT .we')[0].value = timesheetRow.weOver == undefined ? "0" : timesheetRow.weOver;
        $('#row' + rowId + ' .OT .th')[0].value = timesheetRow.thOver == undefined ? "0" : timesheetRow.thOver;
        $('#row' + rowId + ' .OT .fri')[0].value = timesheetRow.friOver == undefined ? "0" : timesheetRow.friOver;
        $('#row' + rowId + ' .OT .sat')[0].value = timesheetRow.satOver == undefined ? "0" : timesheetRow.satOver;

        $('.ST input').on('change', function () { totalHours(); });
        $('.OT input').on('change', function () { totalHours(); });

        $('#tsContainer input').each(function () {
            $(this).attr('readonly', 'readonly');
        });

        $('#tsContainer select').each(function () {
            $(this).attr('readonly', 'readonly');
        });

        $('.row .OT').attr('style', 'display: none;');
        $('.ST .input-group .fri').each(function () {
            $(this).prop("readonly", true);
            $(this).prop("disabled", true);
            $(this).attr("style", "display:none;");

        });
        $('.ST .input-group .sat').each(function () {
            $(this).prop("readonly", true);
            $(this).prop("disabled", true);
            $(this).attr("style", "display:none;");
        });
    }

    function getProjects(ddlProj, isProject) {

        if (isProject) {
            var projList = $('#' + ddlProj);

            $.ajax({
                type: "GET",
                url: "/project/GetProjects?userId=" + $('#ddlEmployeesTimeSheets').val(),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    projList.attr('isPro', 'true');
                    projList.empty();
                    $.each(data, function () {
                        projList.append($("<option></option>").val(this.id).html(this.name));
                    });
                    ddlProjChange($('#' + ddlProj)[0]);
                },
                failure: function (response) {
                    console.log(response);
                }
            });

        }
        else {
            var projList = $('#' + ddlProj);
            projList.attr('isPro', 'false');
            projList.empty();
            projList.append($("<option></option>").val('General').html('General Activities'));

            var rowNumber = ddlProj.replace('ddlPro', '');

            $.ajax({
                type: "GET",
                url: "/Activity/GetGeneral",
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    $("#ddlAct" + rowNumber).empty();
                    $.each(data, function () {
                        $('#ddlAct' + rowNumber).append($("<option></option>").val(this.id).html(this.name));
                    });
                },
                failure: function (response) {
                    console.log(response);
                }
            });

        }

    }

    function ddlProjChange(ddlProj) {

        var rowNumber = ddlProj.id.replace('ddlPro', '');

        if ($(ddlProj).attr('isPro') == 'true') {
            $.ajax({
                type: "GET",
                url: "/activity/GetProjectActivity?projectId=" + $(ddlProj).val() + "&userId=" + $('#ddlEmployeesTimeSheets').val(),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    $("#ddlAct" + rowNumber).empty();
                    $.each(data, function () {
                        $("#ddlAct" + rowNumber).append($("<option></option>").val(this.id).html(this.name));
                    });
                },
                failure: function (response) {
                    console.log(response);
                }
            });
        }
    }

    function approveTimeSheet() {
        xdialog.startSpin();
        $.ajax({
            type: "GET",
            url: "/timesheet/ApproveTimeSheetManager?timesheetId=" + $('#ddlTimeSheets').val() + "&isApproved=true&comments=" + "comments approve",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (data) {
                xdialog.stopSpin();
                xdialog.open({
                    title: 'Information',
                    body: 'Time sheet has been approved.',
                    buttons: ['ok'],
                    style: 'min-width:38em;',
                    onok: function (param) {
                    }
                });
                getDashboard();
                xdialog.startSpin();
                $.ajax({
                    type: "GET",
                    url: "/manager/GetTeamPendingEmployees",
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (data) {
                        console.log(data);
                        if (data.length > 0) {
                            $('#ddlEmployeesTimeSheets').attr('style', 'display:block;');
                            $('#ddlTimeSheets').attr('style', 'display:block;');
                            $('#spNoEmployeesTimesheet').attr('style', 'display:none;');
                            $("#ddlEmployeesTimeSheets").empty();
                            $.each(data, function () {
                                $("#ddlEmployeesTimeSheets").append($("<option></option>").val(this.id).html(this.firstName));
                            });
                            ddlEmployeeTimeSheetChange();
                            $('#timesheetRow').attr('style', 'display:block;');
                            $('#timeSheetTable').attr('style', 'display:block;');
                            xdialog.stopSpin();
                        }
                        else {
                            $('#spNoEmployeesTimesheet').attr('style', 'display:block;');
                            $('#ddlEmployeesTimeSheets').attr('style', 'display:none;');
                            $('#ddlEmployeesTimeSheets').empty();
                            $('#ddlTimeSheets').attr('style', 'display:none;');
                            $('#timesheetRow').attr('style', 'display:none;');
                            $('#timeSheetTable').attr('style', 'display:none;');
                            xdialog.stopSpin();
                        }
                    },
                    failure: function (response) {
                        console.log(response);
                        xdialog.stopSpin();
                    }
                });
            },
            failure: function (response) {
                console.log(response);
            }
        });
    }

    function addRejectComment() {
        xdialog.startSpin();
        var isValid = true;
        if ($('#inpComment').val().trim() == '') {
            $('#errComment').attr('style', 'display:block;color:red;');
            isValid = false;
        }

        if (isValid) {
            $.ajax({
                type: "GET",
                url: "/timesheet/ApproveTimeSheetManager?timesheetId=" + $('#ddlTimeSheets').val() + "&isApproved=false&comments=" + $('#inpComment').val(),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (data) {
                    xdialog.stopSpin();
                    $('#addComments').modal('hide');
                    xdialog.open({
                        title: 'Information',
                        body: 'Time sheet rejected.',
                        buttons: ['ok'],
                        style: 'min-width:38em;',
                        onok: function (param) {
                        }
                    });
                    getDashboard();
                    xdialog.startSpin();
                    $.ajax({
                        type: "GET",
                        url: "/manager/GetTeamPendingEmployees",
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (data) {
                            console.log(data);
                            if (data.length > 0) {
                                $('#ddlEmployeesTimeSheets').attr('style', 'display:block;');
                                $('#ddlTimeSheets').attr('style', 'display:block;');
                                $('#spNoEmployeesTimesheet').attr('style', 'display:none;');
                                $("#ddlEmployeesTimeSheets").empty();
                                $.each(data, function () {
                                    $("#ddlEmployeesTimeSheets").append($("<option></option>").val(this.id).html(this.firstName));
                                });
                                ddlEmployeeTimeSheetChange();
                                $('#timesheetRow').attr('style', 'display:block;');
                                $('#timeSheetTable').attr('style', 'display:block;');
                                xdialog.stopSpin();
                            }
                            else {
                                $('#spNoEmployeesTimesheet').attr('style', 'display:block;');
                                $('#ddlEmployeesTimeSheets').attr('style', 'display:none;');
                                $('#ddlEmployeesTimeSheets').empty();
                                $('#ddlTimeSheets').attr('style', 'display:none;');
                                $('#timesheetRow').attr('style', 'display:none;');
                                $('#timeSheetTable').attr('style', 'display:none;');
                                xdialog.stopSpin();
                            }
                        },
                        failure: function (response) {
                            console.log(response);
                            xdialog.stopSpin();
                        }
                    });
                },
                failure: function (response) {
                    console.log(response);
                }
            });
        }
    }

    function rejectTimeSheet() {
        $('#addComments').modal('show');
    }

    Date.prototype.formatMMDDYYYY = function () {
        return this.getDate() +
            "-" + (this.getMonth() + 1) +
            "-" + this.getFullYear();
    }

    function validateHours(evt) {
        return digitKeyOnly(evt);
    }

    function digitKeyOnly(e) {
        var keyCode = e.keyCode == 0 ? e.charCode : e.keyCode;
        var value = Number(e.key);

        if ((keyCode >= 37 && keyCode <= 40) || (keyCode == 8 || keyCode == 9 || keyCode == 13) || (keyCode >= 48 && keyCode <= 57)) {
            var isValidDigit = isValidNumber(value);
            if (e.target.value > 9) {
                isValidDigit = false;
            }

            var total = 0;

            $('.ST .' + $(e.target).attr('class').split(' ')[1]).each(function () {
                if (this != e.target) {
                    total += Number($(this).val());
                }
            });
            if (isValidDigit) {
                if ($(e.target).parents('.OT').length == 0) {
                    total += value;
                    if (total > 9) {
                        e.target.preventDefault;
                        isValidDigit = false;
                        xdialog.open({
                            title: 'Validation error',
                            body: 'Standartd time not exceed 9 hours!',
                            buttons: ['ok'],
                            style: 'min-width:38em;',
                            onok: function (param) {
                            }
                        });
                    }
                    else {
                        isValidDigit = true;
                    }
                }
            }
            return isValidDigit;
        }
        return false;
    }

    function isValidNumber(number) {
        return (1 <= number && number <= 9)
    }

    function totalHoursHistory() {
        var total = 0;
        $('#tsContainerHistory').find('.ST .sun').each(function () {
            total += Number($(this).val());
        });
        $('#tsContainerHistory').find('.OT .sun').each(function () {
            total += Number($(this).val());
        });
        $('#timeSheetHistoryTable').find('.sunTotal').val(total);
        $('#timeSheetHistoryTable').find('.sunTotal').attr('style', 'font-weight:bold;');

        var total = 0;
        $('#tsContainerHistory').find('.ST .mon').each(function () {
            total += Number($(this).val());
        });
        $('#tsContainerHistory').find('.OT .mon').each(function () {
            total += Number($(this).val());
        });
        $('#timeSheetHistoryTable').find('.monTotal').val(total);
        $('#timeSheetHistoryTable').find('.monTotal').attr('style', 'font-weight:bold;');

        var total = 0;
        $('#tsContainerHistory').find('.ST .tu').each(function () {
            total += Number($(this).val());
        });
        $('#tsContainerHistory').find('.OT .tu').each(function () {
            total += Number($(this).val());
        });
        $('#timeSheetHistoryTable').find('.tuTotal').val(total);
        $('#timeSheetHistoryTable').find('.tuTotal').attr('style', 'font-weight:bold;');

        var total = 0;
        $('#tsContainerHistory').find('.ST .we').each(function () {
            total += Number($(this).val());
        });
        $('#tsContainerHistory').find('.OT .we').each(function () {
            total += Number($(this).val());
        });
        $('#timeSheetHistoryTable').find('.weTotal').val(total);
        $('#timeSheetHistoryTable').find('.weTotal').attr('style', 'font-weight:bold;');


        var total = 0;
        $('#tsContainerHistory').find('.ST .th').each(function () {
            total += Number($(this).val());
        });
        $('#tsContainerHistory').find('.OT .th').each(function () {
            total += Number($(this).val());
        });
        $('#timeSheetHistoryTable').find('.thTotal').val(total);
        $('#timeSheetHistoryTable').find('.thTotal').attr('style', 'font-weight:bold;');

        var total = 0;
        $('#tsContainerHistory').find('.ST .fri').each(function () {
            total += Number($(this).val());
        });
        $('#tsContainerHistory').find('.OT .fri').each(function () {
            total += Number($(this).val());
        });
        $('#timeSheetHistoryTable').find('.friTotal').val(total);
        $('#timeSheetHistoryTable').find('.friTotal').attr('style', 'font-weight:bold;');

        var total = 0;
        $('#tsContainerHistory').find('.ST .sat').each(function () {
            total += Number($(this).val());
        });
        $('#tsContainerHistory').find('.OT .sat').each(function () {
            total += Number($(this).val());
        });
        $('#timeSheetHistoryTable').find('.satTotal').val(total);
        $('#timeSheetHistoryTable').find('.satTotal').attr('style', 'font-weight:bold;');

    }

    function totalHours() {
        var total = 0;
        $('#tsContainer').find('.ST .sun').each(function () {
            total += Number($(this).val());
        });
        $('#tsContainer').find('.OT .sun').each(function () {
            total += Number($(this).val());
        });
        $('#timeSheetTable').find('.sunTotal').val(total);
        $('#timeSheetTable').find('.sunTotal').attr('style', 'font-weight:bold;');

        var total = 0;
        $('#tsContainer').find('.ST .mon').each(function () {
            total += Number($(this).val());
        });
        $('#tsContainer').find('.OT .mon').each(function () {
            total += Number($(this).val());
        });
        $('#timeSheetTable').find('.monTotal').val(total);
        $('#timeSheetTable').find('.monTotal').attr('style', 'font-weight:bold;');

        var total = 0;
        $('#tsContainer').find('.ST .tu').each(function () {
            total += Number($(this).val());
        });
        $('#tsContainer').find('.OT .tu').each(function () {
            total += Number($(this).val());
        });
        $('#timeSheetTable').find('.tuTotal').val(total);
        $('#timeSheetTable').find('.tuTotal').attr('style', 'font-weight:bold;');

        var total = 0;
        $('#tsContainer').find('.ST .we').each(function () {
            total += Number($(this).val());
        });
        $('#tsContainer').find('.OT .we').each(function () {
            total += Number($(this).val());
        });
        $('#timeSheetTable').find('.weTotal').val(total);
        $('#timeSheetTable').find('.weTotal').attr('style', 'font-weight:bold;');


        var total = 0;
        $('#tsContainer').find('.ST .th').each(function () {
            total += Number($(this).val());
        });
        $('#tsContainer').find('.OT .th').each(function () {
            total += Number($(this).val());
        });
        $('#timeSheetTable').find('.thTotal').val(total);
        $('#timeSheetTable').find('.thTotal').attr('style', 'font-weight:bold;');

        var total = 0;
        $('#tsContainer').find('.ST .fri').each(function () {
            total += Number($(this).val());
        });
        $('#tsContainer').find('.OT .fri').each(function () {
            total += Number($(this).val());
        });
        $('#timeSheetTable').find('.friTotal').val(total);
        $('#timeSheetTable').find('.friTotal').attr('style', 'font-weight:bold;');

        var total = 0;
        $('#tsContainer').find('.ST .sat').each(function () {
            total += Number($(this).val());
        });
        $('#tsContainer').find('.OT .sat').each(function () {
            total += Number($(this).val());
        });
        $('#timeSheetTable').find('.satTotal').val(total);
        $('#timeSheetTable').find('.satTotal').attr('style', 'font-weight:bold;');

    }
</script>
<style>
    .time-cell {
        width: 58px;
        margin: 10px 10px 10px 10px;
    }

    .time-cell-total {
        width: 58px;
        margin: 10px 10px 10px 10px;
    }

    .seper {
        margin-bottom: 1rem;
        border: 0;
        border-top: 1px solid rgba(0, 0, 0, 0.1);
    }

    span.select2.select2-container.select2-container--default {
        width: 100% !important;
    }

    i.state-icon.fa.fa-angle-right {
        margin-right: 10px;
    }

    i.item-icon.fas.fa-user {
        margin-right: 10px;
    }

    i.state-icon.fa-angle-down.fa {
        margin-right: 10px;
    }
</style>